{% extends 'base.html' %}
{% block head %}
    <link rel="stylesheet" href="{{ url_for('static',filename='css/editblog.css') }}">
{% endblock %}
{% block main %}


    <div class="main">
        <h3 class="page_title">发表博客</h3>
        <form id="blog" method="post">
            <div class="form-container">
                <div class="form-group">
                    <input type="text" name="title" placeholder="请输入标题" class="form-control">
                </div>
                <div class="form-group">
                    <input type="text" name="tags" placeholder="请输入标签,如果有一个以上,用半角逗号,隔开" class="form-control">
                </div>
                <div class="select_category">
                    <label for="category_id">选择分类
                        {% for category in categorys %}
                            <input id="r1" type="radio" value="{{ category.id }}" name="category_id"/>
                            {{ category.name }}
                        {% endfor %}
                    </label>
                </div>
                <div class="form-group" id="div1">
                    <p>文章内容</p></div>
                <textarea id="editor" name="content" class="form-control" style="width:100%; height:200px;"></textarea>

                <div class="form-group">
                    <button id="btn" class="btn btn-default btn-block" onclick="SubmitForm();">发布</button>
                </div>
            </div>
        </form>
        <div class="form-group">
            <form class="category" action="{{ url_for('add_category') }}" method="post">
                <input type="text" name="category_name" class="form-control" placeholder="分类名称">
                <input type="submit" class="category_submit" value="增加分类">
            </form>
        </div>
    </div>


    {#<button id="btn1" onclick="SubmitForm();">获取内容</button>#}

    <script type="text/javascript" src="../static/js/wangEditor.min.js"></script>
    <script type="text/javascript">
        var E = window.wangEditor
        var editor = new E('#div1')
        var $text1 = $('#editor')
        editor.customConfig.onchange = function (html) {
            // 监控变化，同步更新到 textarea
            $text1.val(html)
        }
        editor.create()
        // 初始化 textarea 的值
        $text1.val(editor.txt.html())
        {#    var text_area = document.getElementById('editor');#}
        {#    var editor = new wangEditor(text_area);#}
        {#    editor.create();#}
        {#var html = editor.$txt.html();#}


        function SubmitForm() {
            var data = {};
            var html = editor.$txt.html();
            data = $('#blog').serialize();
            $.ajax({
                url: '/new_editor/',
                type: 'POST',
                data: {data, 'content': a, 'content1': html},
                dataType: 'json',
                success:
                    function (data) {
                        if (data.status) {
                            location.href = "http://www.baidu.com";
                        }
                        else {
                            alert(data.message)
                        }
                    }
            })
        }
    </script>

{% endblock %}